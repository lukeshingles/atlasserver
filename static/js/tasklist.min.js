"use strict";var a=!1,f={},g={},h={},i=!1,j=[],k="",o=ReactDOM.createRoot(document.getElementById("taskpage"));function b(){return (mjdFromDate(new Date())-30).toFixed(5)}class NewRequest extends React.Component{get_defaultstate(){return{showradechelp:!1,radeclist:localStorage.getItem("radeclist")!=null?localStorage.getItem("radeclist"):"",mjd_min:localStorage.getItem("mjd_min")!=null?localStorage.getItem("mjd_min"):b(),mjd_max:localStorage.getItem("mjd_max")!=null?localStorage.getItem("mjd_max"):"",comment:localStorage.getItem("comment")!=null?localStorage.getItem("comment"):"",use_reduced:localStorage.getItem("use_reduced")=="true",send_email:localStorage.getItem("send_email")!="false",enable_propermotion:localStorage.getItem("enable_propermotion")=="true",radec_epoch_year:localStorage.getItem("radec_epoch_year")!=null?localStorage.getItem("radec_epoch_year"):"",propermotion_ra:localStorage.getItem("propermotion_ra")!=null?localStorage.getItem("propermotion_ra"):0,propermotion_dec:localStorage.getItem("propermotion_dec")!=null?localStorage.getItem("propermotion_dec"):0,errors:[],httperror:"",submission_in_progress:!1}}constructor(A){super(A);this.state=this.get_defaultstate();this.handlechange_mjd_min=this.handlechange_mjd_min.bind(this);this.update_mjd_min=this.update_mjd_min.bind(this);this.handlechange_mjd_max=this.handlechange_mjd_max.bind(this);this.update_mjd_max=this.update_mjd_max.bind(this);this.submit=this.submit.bind(this)}componentDidMount(){this.update_mjd_min(this.state.mjd_min);this.update_mjd_max(this.state.mjd_max)}update_mjd_min(A){var _="";if(A=="")_="(leave blank to fetch earliest)";else try {var c=parseFloat(A),d=dateFromMJD(c).toISOString();_=d.includes(".")?d.split(".")[0]+"Z":d} catch (B) {_="error";console.log("error",B,B.message)}this.setState({"mjd_min":A,"mjd_min_isoformat":_})}handlechange_mjd_min(A){this.update_mjd_min(A.target.value);localStorage.setItem("mjd_min",A.target.value)}update_mjd_max(A){var _="";if(A=="")_="(leave blank to fetch latest)";else try {var c=parseFloat(A),d=dateFromMJD(c).toISOString();console.log("invalid?",A,c);_=d.includes(".")?d.split(".")[0]+"Z":d} catch (B) {_="error";console.log("error",B,B.message)}this.setState({"mjd_max":A,"mjd_max_isoformat":_});localStorage.setItem("mjd_max",A)}handlechange_mjd_max(A){this.update_mjd_max(A.target.value)}submit(){var A={radeclist:this.state.radeclist,mjd_min:this.state.mjd_min==""?null:this.state.mjd_min,mjd_max:this.state.mjd_max==""?null:this.state.mjd_max,use_reduced:this.state.use_reduced,send_email:this.state.send_email,comment:this.state.comment};this.state.enable_propermotion&&(A["radec_epoch_year"]=this.state.radec_epoch_year,A["propermotion_ra"]=this.state.propermotion_ra,A["propermotion_dec"]=this.state.propermotion_dec);console.log(A);fetch(api_url_base,{credentials:"same-origin",method:"POST",body:JSON.stringify(A),headers:{"X-CSRFToken":getCookie("csrftoken"),"Accept":"application/json","Content-Type":"application/json"}}).catch(_=>{a=!1;console.log("New task HTTP request failed",_);this.setState({"httperror":"HTTP request failed.","submission_in_progress":!1})}).then(_=>{a=!1;this.setState({"httperror":"","submission_in_progress":!1});console.log("New task: HTTP response ",_.status);if(_.status==201){console.log("New task: successful creation",_.status);localStorage.removeItem("radeclist");localStorage.removeItem("enable_propermotion");localStorage.removeItem("radec_epoch_year");localStorage.removeItem("propermotion_ra");localStorage.removeItem("propermotion_dec");localStorage.removeItem("mjd_min");localStorage.removeItem("mjd_max");localStorage.removeItem("comment");this.setState(this.get_defaultstate());_.json().then(B=>{for(const c of B){console.log("Created new task",c.id);newtaskids.push(c.id)}});window.history.pushState({},document.title,api_url_base);this.props.fetchData(!0)}else _.status==400?_.json().then(B=>{console.log("New task: errors returned",B);this.setState({"errors":B})}):console.log("New task: Error on submission: ",_.status);}).catch(_=>{a=!1;console.log("New task HTTP request failed",_);this.setState({"httperror":"HTTP request failed. Check internet connection and server are online.","submission_in_progress":!1})})}onSubmit(){event.preventDefault();if(a){console.log("New task: Submission already in progress");return}console.log("New task: Submitting",api_url_base);a=!0;this.setState({"submission_in_progress":!1});this.submit()}render(){var A=[],_=a?"btn btn-info submitting":"btn btn-info",c=a?"Requesting...":"Request";A.push(React.createElement("ul",{key:"ulradec"},React.createElement("li",null,React.createElement("label",{htmlFor:"id_radeclist"},"RA Dec / MPC names:"),React.createElement("textarea",{name:"radeclist",cols:"",rows:"3",required:!0,id:"id_radeclist",value:this.state.radeclist,onChange:e=>{this.setState({"radeclist":e.target.value});localStorage.setItem("radeclist",e.target.value)}}),"\xA0",React.createElement("a",{onClick:()=>this.setState({"showradechelp":!this.state.showradechelp})},"Help"),this.state.showradechelp?React.createElement("div",{id:"radec_help", style:{display:"block",clear:"right",fontSize:"small"}, className:"collapse"},"Each line should consist of a right ascension and a declination coordinate (J2000) in decimal or sexagesimal notation (RA/DEC separated by a space or a comma) or 'mpc ' and a Minor Planet Center object name (e.g. 'mpc Makemake'). Limit of 100 objects per submission. If requested, email notification will be sent only after all targets in the list have been processed."):null),"radeclist" in this.state.errors?React.createElement("ul",{className:"errorlist"},React.createElement("li",null,this.state.errors["radeclist"])):""));A.push(React.createElement("div",{key:"propermotion_checkbox", id:"propermotion_checkboxdiv", style:{width:"100%"}},React.createElement("label",{style:{width:"100%"}},React.createElement("input",{type:"checkbox",checked:this.state.enable_propermotion,onChange:e=>{this.setState({"enable_propermotion":e.target.checked});localStorage.setItem("enable_propermotion",e.target.checked)},style:{position:"static",display:"inline",width:"5em"}})," Proper motion")));this.state.enable_propermotion&&A.push(React.createElement("div",{key:"propermotion_panel", id:"propermotion_panel", style:{background:"rgb(235,235,235)"}},React.createElement("p",{key:"propermotiondesc", style:{fontSize:"small"}},"If the star is moving, the J2000 coordinates above are correct for a specified epoch along with proper motions in RA (angle) and Dec in milliarcseconds. The epoch of ATLAS observations varies from 2015.5 to the present. Note: these are angular velocities, not rates of coordinate change."),React.createElement("ul",{key:"propermotion_inputs"},React.createElement("li",{key:"radec_epoch_year"},React.createElement("label",{htmlFor:"id_radec_epoch_year"},"Epoch year:"),React.createElement("input",{type:"number",name:"radec_epoch_year",step:"0.1",id:"id_radec_epoch_year",value:this.state.radec_epoch_year,onChange:e=>{this.setState({"radec_epoch_year":e.target.value});localStorage.setItem("radec_epoch_year",e.target.value)}})),React.createElement("li",{key:"propermotion_ra"},React.createElement("label",{htmlFor:"id_propermotion_ra"},"PM RA [mas/yr]"),React.createElement("input",{type:"number",name:"propermotion_ra",step:"any",id:"id_propermotion_ra",value:this.state.propermotion_ra,onChange:e=>{this.setState({"propermotion_ra":e.target.value});localStorage.setItem("propermotion_ra",e.target.value)}})),React.createElement("li",{key:"propermotion_dec"},React.createElement("label",{htmlFor:"id_propermotion_dec"},"PM Dec [mas/yr]"),React.createElement("input",{type:"number",name:"propermotion_dec",step:"any",id:"id_propermotion_dec",value:this.state.propermotion_dec,onChange:e=>{this.setState({"propermotion_dec":e.target.value});localStorage.setItem("propermotion_dec",e.target.value)}})))));A.push(React.createElement("ul",{key:"ulmjdoptions"},React.createElement("li",{key:"mjd_min"},React.createElement("label",{htmlFor:"id_mjd_min"},"MJD min:"),React.createElement("input",{type:"number",name:"mjd_min",step:"any",id:"id_mjd_min",value:this.state.mjd_min,onChange:this.handlechange_mjd_min}),React.createElement("a",{className:"btn", onClick:()=>{this.setState({"mjd_min":b()});this.update_mjd_min(b());localStorage.removeItem("mjd_min")}},"\u21A9\uFE0F"),React.createElement("p",{className:"inputisodate", id:"id_mjd_min_isoformat"},this.state.mjd_min_isoformat)),React.createElement("li",{key:"mjd_max"},React.createElement("label",{htmlFor:"id_mjd_max"},"MJD max:"),React.createElement("input",{type:"number",name:"mjd_max",step:"any",id:"id_mjd_max",value:this.state.mjd_max,onChange:this.handlechange_mjd_max}),React.createElement("p",{className:"inputisodate", id:"id_mjd_max_isoformat"},this.state.mjd_max_isoformat),"mjd_max" in this.state.errors?React.createElement("ul",{className:"errorlist"},React.createElement("li",null,this.state.errors["mjd_max"])):""),React.createElement("li",{key:"comment"},React.createElement("label",{htmlFor:"id_comment"},"Comment:"),React.createElement("input",{type:"text",name:"comment",maxLength:"300",id:"id_comment",value:this.state.comment,onChange:e=>{this.setState({"comment":e.target.value});localStorage.setItem("comment",e.target.value)}})),React.createElement("li",{key:"use_reduced"},React.createElement("input",{type:"checkbox",name:"use_reduced",id:"id_use_reduced",checked:this.state.use_reduced,onChange:e=>{this.setState({"use_reduced":e.target.checked});localStorage.setItem("use_reduced",e.target.checked)}}),React.createElement("label",{htmlFor:"id_use_reduced"},"Use reduced (input) instead of difference images (",React.createElement("a",{href:"../faq/"},"FAQ"),")")),React.createElement("li",{key:"send_email"},React.createElement("input",{type:"checkbox",name:"send_email",id:"id_send_email",checked:this.state.send_email,onChange:e=>{this.setState({"send_email":e.target.checked});localStorage.setItem("send_email",e.target.checked)}}),React.createElement("label",{htmlFor:"id_send_email"},"Email me when completed"))));A.push(React.createElement("input",{key:"submitbutton",className:_,id:"submitrequest",type:"submit",value:c}));this.state.httperror!=""&&A.push(React.createElement("p",{key:"httperror", style:{"color":"red"}},this.state.httperror));return React.createElement("div",{key:"newrequestcontainer", id:"newrequestcontainer"},React.createElement("div",{key:"newrequestsource", className:"newrequest", id:"newrequestsource"},React.createElement("div",{key:"newtask", className:"task"},React.createElement("h2",{key:"newtaskheader"},"New request"),React.createElement("form",{key:"newtaskform", id:"newrequest", onSubmit:this.onSubmit.bind(this)},A))))}}class TaskPlot extends React.PureComponent{constructor(A){super(A)}componentDidMount(){console.log("activating plot",this.props.taskid);var A=new URL(this.props.taskurl);A.pathname+="resultplotdata.js";A.search="";$.ajax({url:A,cache:!0,dataType:"script"})}componentWillUnmount(){console.log("Unmounting plot for task ",this.props.taskid);delete h["#plotforcedflux-task-"+this.props.taskid];delete f["#plotforcedflux-task-"+this.props.taskid];delete g["#plotforcedflux-task-"+this.props.taskid]}render(){return React.createElement("div",{key:"plot",id:"plotforcedflux-task-"+this.props.taskid,className:"plot",style:{width:"100%",height:"300px"}})}}class Task extends React.Component{constructor(A){super(A);this.state={};this.state.updateTimeElapsed=this.updateTimeElapsed.bind(this);this.state.interval=null;this.state.timeelapsed=-1}deleteTask(){$("#task-"+this.props.taskdata.id).slideUp(200);setTimeout(()=>$.ajax({headers:{"X-CSRFToken":getCookie("csrftoken")},url:this.props.taskdata.url,method:"delete",success:()=>{console.log("Deleted task ",this.props.taskdata.id);this.props.fetchData()},error:A=>{console.log("Failed to delete task ",this.props.taskdata.id,A);$("#task-"+this.props.taskdata.id).slideDown(100);this.props.fetchData()}}),200)}requestImages(){var A=new URL(this.props.taskdata.url);A.pathname+="requestimages";A.search="";fetch(A,{credentials:"same-origin",method:"GET",headers:{"X-CSRFToken":getCookie("csrftoken"),"Accept":"application/json","Content-Type":"application/json"}}).then(_=>{if(_.redirected){var B=parseInt(new URL(_.url).searchParams.get("newids")),c=new URL(_.url);newtaskids.push(B);console.log("requestimages created task",B);c.searchParams.delete("newids");window.history.pushState({},document.title,c);this.props.fetchData(!0)}})}getDerivedStateFromProps(A,_){if(A.taskdata.starttimestamp!=null&&A.taskdata.finishtimestamp==null)if(_.interval==null){var c=new Date(A.taskdata.starttimestamp).getTime(),d=(new Date().getTime()-c)/1000;return{"interval":setInterval(_.updateTimeElapsed,1000),"timeelapsed":d.toFixed(0)}} else if(_.interval!=null)return{"interval":null};return null}componentDidMount(){this.updateTimeElapsed();if(newtaskids.includes(this.props.taskdata.id)){var A="#task-"+this.props.taskdata.id;console.log("showing new task",this.props.taskdata.id);$(A).hide();$(A).slideDown(200);newtaskids=newtaskids.filter(item=>item!==this.props.taskdata.id)}}componentWillUnmount(){clearInterval(this.state.interval)}updateTimeElapsed(){if(this.props.taskdata.starttimestamp!=null&&this.props.taskdata.finishtimestamp==null){var A=new Date(this.props.taskdata.starttimestamp).getTime(),_=(new Date().getTime()-A)/1000;this.setState({"timeelapsed":_.toFixed(0)})}else this.state.interval!=null&&(clearInterval(this.state.interval),this.setState({"interval":null}))}shouldComponentUpdate(A){if(A.taskdata.starttimestamp!=null&&A.taskdata.finishtimestamp==null)return!0;if(JSON.stringify(A)!=JSON.stringify(this.props))return!0;return!1}render(){var A=this.props.taskdata,_="none",e=[React.createElement("div",{key:"rightside", className:"rightside"},null,React.createElement("img",{src:A.previewimage_url,style:{display:"block",marginTop:"1em",marginLeft:"1em"}}))];if(A.finishtimestamp!=null){_="finished";c="Delete"}else A.starttimestamp!=null?(_="queued started",c="Cancel"):(_="queued notstarted",c="Cancel");console.log("Task "+A.id+" rendered");A.user_id==user_id&&(d=React.createElement("button",{className:"btn btn-sm btn-danger", onClick:()=>this.deleteTask()},"none"));e.push(React.createElement("div",{key:"tasknum"},React.createElement("a",{key:"tasklink", href:A.url, onClick:e=>this.props.setSingleTaskView(e,A.id,A.url)},"Task ",A.id)));A.parent_task_url?e.push(React.createElement("p",{key:"imgrequest"},"Image request for ",React.createElement("a",{key:"parent_task_link", href:A.parent_task_url, onClick:e=>this.props.setSingleTaskView(e,A.parent_task_id,A.parent_task_url)},"Task ",A.parent_task_id))):A.parent_task_id?e.push(React.createElement("p",{key:"imgrequest"},"Image request for Task ",A.parent_task_id," (deleted)")):A.request_type=="IMGZIP"&&e.push(React.createElement("p",{key:"imgrequest"},"Image request"));if(A.request_type=="IMGZIP"){var B=A.use_reduced?"reduced":"difference";e.push(React.createElement("p",{key:"imgrequestnote"},"Up to the first 500 ",B," images will be retrieved. The image request and download link may expire after one week."))}A.user_id!=user_id&&e.push(React.createElement("div",{key:"user"},"User: ",A.username));A.comment!=null&&A.comment!=""&&e.push(React.createElement("div",{key:"comment"},"Comment: ",React.createElement("b",null,A.comment)));if(A.mpc_name!=null&&A.mpc_name!="")e.push(React.createElement("div",{key:"target"},"MPC Object: ",A.mpc_name));else{var G="";A.radec_epoch_year!=null&&(G=React.createElement("span",null,"(epoch ",A.radec_epoch_year,") "));e.push(React.createElement("div",{key:"target"},"RA Dec: ",G,A.ra," ",A.dec));A.propermotion_ra>0||A.propermotion_dec>0&&e.push(React.createElement("div",{key:"propermotion"},"Proper motion [mas/yr]: ",A.propermotion_ra," ",A.propermotion_dec))}e.push(React.createElement("div",{key:"imgtype"},"Images: ",A.use_reduced?"Reduced":"Difference"));if(A.mjd_min!=null||A.mjd_max!=null){var H=A.mjd_min!=null?A.mjd_min:"0",I=A.mjd_max!=null?A.mjd_max:"\u221E";e.push(React.createElement("div",{key:"mjdrange"},"MJD request: [",H,", ",I,"]"))}e.push(React.createElement("div",{key:"queuetime"},"Queued at ",new Date(A.timestamp).toLocaleString()));if(A.finishtimestamp!=null){e.push(React.createElement("div",{key:"status"},"Finished at ",new Date(A.finishtimestamp).toLocaleString()));if(A.error_msg!=null)e.push(React.createElement("p",{key:"error_msg", style:{color:"black",fontWeight:"bold",marginTop:"1em"}},"Error: ",A.error_msg));else{A.request_type=="FP"&&(e.push(React.createElement("a",{key:"datalink", className:"results btn btn-info getdata", href:A.result_url, target:"_blank"},"Data")),e.push(React.createElement("a",{key:"pdflink", className:"results btn btn-info getpdf", href:A.pdfplot_url, target:"_blank"},"PDF")));A.request_type=="IMGZIP"?A.result_imagezip_url!=null?e.push(React.createElement("a",{key:"imgdownload", className:"results btn btn-info", href:A.result_imagezip_url},"Download images (ZIP)")):e.push(React.createElement("p",null,"The download link has expired. Delete this task and request again if necessary.")):A.imagerequest_task_id!=null?A.imagerequest_finished?e.push(React.createElement("a",{key:"imgrequest", className:"btn btn-primary", href:A.imagerequest_url, onClick:e=>this.props.setSingleTaskView(e,A.imagerequest_task_id,A.imagerequest_url)},"Images retrieved")):e.push(React.createElement("a",{key:"imgrequest", className:"btn btn-warning", href:A.imagerequest_url, onClick:e=>this.props.setSingleTaskView(e,A.imagerequest_task_id,A.imagerequest_url)},"Images requested")):user_id==A.user_id&&e.push(React.createElement("button",{key:"imgrequest", className:"btn btn-info", onClick:()=>this.requestImages(), title:"Download FITS and JPEG images for up to the first 500 observations."},"Request ",A.use_reduced?"reduced":"diff"," images"))}}else A.starttimestamp!=null?e.push(React.createElement("div",{key:"status", style:{color:"red",fontStyle:"italic",marginTop:"1em"}},"Running (started ",this.state.timeelapsed," seconds ago)")):e.push(React.createElement("div",{key:"status", style:{fontStyle:"italic",marginTop:"1em"}},"Waiting (",A.queuepos," tasks ahead of this one)"));A.finishtimestamp!=null&&A.error_msg==null&&A.request_type=="FP"&&!this.props.hidePlot&&e.push(React.createElement(TaskPlot,{key:"plot",taskid:A.id,taskurl:A.url}));return React.createElement("li",{key:"task-"+A.id, className:`task ${_}`, id:"task-"+A.id},e)}}class Pager extends React.PureComponent{constructor(A){super(A);this.state={};this.props.previous!=null&&(this.state.previous_cursor=new URL(this.props.previous).searchParams.get("cursor"));this.props.next!=null&&(this.state.next_cursor=new URL(this.props.next).searchParams.get("cursor"))}getDerivedStateFromProps(A){var _={};A.previous!=null&&(_.previous_cursor=new URL(A.previous).searchParams.get("cursor"));A.next!=null&&(_.next_cursor=new URL(A.next).searchParams.get("cursor"));return _}render(){console.log("Pager rendered");if(this.props.taskcount==null)return null;return React.createElement("div",{id:"paginator", key:"paginator"},React.createElement("p",{key:"pagedescription"},"Showing tasks ",this.props.pagefirsttaskposition+1,"-",this.props.pagefirsttaskposition+this.props.pagetaskcount," of ",this.props.taskcount),React.createElement("ul",{key:"prevnext", className:"pager"},this.props.previous!=null?React.createElement("li",{key:"previous", className:"previous"},React.createElement("a",{onClick:()=>this.props.updateCursor(this.state.previous_cursor), style:{cursor:"pointer"}},"\xAB Newer")):null,this.props.next!=null?React.createElement("li",{key:"next", className:"next"},React.createElement("a",{onClick:()=>this.props.updateCursor(this.state.next_cursor), style:{cursor:"pointer"}},"Older \xBB")):null))}}class TaskPage extends React.Component{constructor(A){super(A);this.state={taskcount:null,results:null,scrollToTopAfterUpdate:!1,dataurl:window.location.href,fetchtimeelapsed:null};this.newRequest=React.createRef();this.setSingleTaskView=this.setSingleTaskView.bind(this);this.updateCursor=this.updateCursor.bind(this);this.fetchData=this.fetchData.bind(this)}filterclass(A,_){var c=new URL(_),d=c.searchParams.get("started");if(A==null){if(d==null&&this.singleTaskViewTaskId(this.state.dataurl)==null)return"btn-primary";return"btn-link"}if(A=="started"){if(d=="true")return"btn-primary";return"btn-link"}}setFilter(A){console.log("changed filter to",A);var _=new URL(api_url_base);_.search="";A!=null&&_.searchParams.set(A,!0);if(_!=window.location.href){window.history.pushState({},document.title,_);var c={"scrollToTopAfterUpdate":!0,dataurl:_};A=="started"&&this.state.results!=null&&(c["results"]=this.state.results.filter(task=>task.starttimestamp!=null),!c["results"].length&&(c["results"]=null));this.setState(c,()=>this.fetchData(!0))}}singleTaskViewTaskId(A){var _=A.toString().replace(api_url_base.toString(),"").split("/").filter(el=>el.length);if(_.length==1&&!isNaN(_[0]))return parseInt(_[0]);return null}setSingleTaskView(A,_){if(A.ctrlKey||A.metaKey||A.shiftKey)return;A.preventDefault();var c=api_url_base+_+"/",d=this.state.results.filter(task=>task.id==_);window.history.pushState({},document.title,c);console.log("Task list changed to single task view for ",c.toString());!d.length&&(d=null);this.setState({results:d, scrollToTopAfterUpdate:!0, next:null, previous:null, pagefirsttaskposition:null, taskcount:null},()=>this.fetchData(!0))}updateCursor(A){if(A==new URL(window.location.href).searchParams.get("cursor"))return;console.log("Task list cursor changed to ",A);var _=new URL(window.location.href);A!=null?_.searchParams.set("cursor",A):_.searchParams.delete("cursor");_.searchParams.delete("format");window.history.pushState({},document.title,_);this.setState({scrollToTopAfterUpdate:!0},()=>this.fetchData(!0))}fetchData(A){if(document[hidden]||!user_is_active)return;this.setState({dataurl:window.location.href});if(A){var _=(window.location.href in j);_?(console.log("using tasklist_fetchcache before GET response",window.location.href),this.setState(j[window.location.href])):(console.log("no tasklist_fetchcache for",window.location.href))}if(i&&!A){console.log("prevent overlapping GET requests");return}i=!0;var c=window.location.href;console.log("Fetching task list from",c);fetch(c,{credentials:"same-origin",method:"GET",headers:{"X-CSRFToken":getCookie("csrftoken"),"Accept":"application/json","Content-Type":"application/json"},redirect:"manual"}).then(B=>{k="";i=!1;if(B.type=="opaqueredirect"){window.location.href=B.url;console.log("Fetch got a redirection to ",B.url)}else{B.status!=200&&console.log("Fetch recieved HTTP status ",B.status);B.status==404&&(window.history.pushState({},document.title,api_url_base),this.setState({scrollToTopAfterUpdate:!0},()=>this.fetchData(!0)));if(B.status==200)return B.json()}return null}).catch(B=>{i=!1;console.log("Get task list HTTP request failed",B);k="Connection error"}).then(B=>{var C=null;B!=null&&B.hasOwnProperty("results")?!B.results.length&&new URL(window.location.href).searchParams.get("cursor")!=null?this.updateCursor(null):C=B:B!=null&&B.hasOwnProperty("id")&&(C={results:[B],next:null,previous:null,pagefirsttaskposition:null,taskcount:null});if(C!=null){C["tasklist_last_fetch_time"]=new Date();j[window.location.href]=C;if(c==window.location.href){console.log("Applying results from",c);A&&(C["scrollToTopAfterUpdate"]=!0);this.setState(C)}else{console.log("Not applying results from",c,"location.href",window.location.href);return}}})}componentDidUpdate(){this.state.scrollToTopAfterUpdate&&(this.setState({scrollToTopAfterUpdate:!1}),window.scrollTo(0,0),window.dispatchEvent(new Event("resize")))}componentDidMount(){this.fetchinterval=setInterval(()=>this.fetchData(!1),2000);this.fetchData(!0)}componentWillUnmount(){clearInterval(this.fetchinterval)}render(){var A=this.singleTaskViewTaskId(this.state.dataurl)!=null,_=[],c;!A?_.push(React.createElement("div",{key:"header", className:"page-header"},React.createElement("h1",null,"Task Queue"))):_.push(React.createElement("div",{key:"header", className:"page-header"},React.createElement("h1",null,"Task ",this.singleTaskViewTaskId(this.state.dataurl))));!A||this.state.results!=null&&this.state.results.length>0&&this.state.results[0].user_id==user_id&&_.push(React.createElement("ul",{key:"filters", id:"taskfilters"},React.createElement("li",{key:"all"},React.createElement("a",{onClick:()=>this.setFilter(null), className:"btn "+this.filterclass(null,this.state.dataurl)},"All tasks")),React.createElement("li",{key:"started"},React.createElement("a",{onClick:()=>this.setFilter("started"), className:"btn "+this.filterclass("started",this.state.dataurl)},"Running/Finished"))));this.state.tasklist_last_fetch_time!=null&&_.push(React.createElement("p",{key:"tasklistfetchstatus", id:"tasklistfetchstatus"},"Last updated: ",this.state.tasklist_last_fetch_time.toLocaleString()," ",React.createElement("span",{className:"errors"},k)));!A&&_.push(React.createElement(NewRequest,{key:"newrequest",fetchData:this.fetchData}));if(this.state.results==null)c=React.createElement("p",{key:"message"},"Loading tasks..."); else if(!this.state.results.length)c=React.createElement("p",{key:"message"},"There are no tasks.");else{var d=this.state.results!=null?this.state.results.length:null;c=[React.createElement("ul",{key:"ultasklist", className:"tasks"},this.state.results.map(task=>React.createElement(Task,{key:task.id,taskdata:task,fetchData:this.fetchData,setSingleTaskView:this.setSingleTaskView,hidePlot:d>10}))),React.createElement(Pager,{key:"pager",previous:this.state.previous,next:this.state.next,pagefirsttaskposition:this.state.pagefirsttaskposition,pagetaskcount:d,taskcount:this.state.taskcount,updateCursor:this.updateCursor})]}_.push(React.createElement("div",{key:"tasklist", id:"tasklist", className:A?"singletaskdetail":null},c));return _}}o.render(React.createElement(TaskPage,null));
