"use strict";var submission_in_progress=!1;function getDefaultMjdMin(){return(mjdFromDate(new Date)-30).toFixed(5)}class NewRequest extends React.Component{get_defaultstate(){return{showradechelp:!1,radeclist:null!=localStorage.getItem("radeclist")?localStorage.getItem("radeclist"):"",mjd_min:null!=localStorage.getItem("mjd_min")?localStorage.getItem("mjd_min"):getDefaultMjdMin(),mjd_max:null!=localStorage.getItem("mjd_max")?localStorage.getItem("mjd_max"):"",comment:null!=localStorage.getItem("comment")?localStorage.getItem("comment"):"",use_reduced:"true"==localStorage.getItem("use_reduced"),send_email:"false"!=localStorage.getItem("send_email"),enable_propermotion:"true"==localStorage.getItem("enable_propermotion"),radec_epoch_year:null!=localStorage.getItem("radec_epoch_year")?localStorage.getItem("radec_epoch_year"):"",propermotion_ra:null!=localStorage.getItem("propermotion_ra")?localStorage.getItem("propermotion_ra"):0,propermotion_dec:null!=localStorage.getItem("propermotion_dec")?localStorage.getItem("propermotion_dec"):0,errors:[],httperror:"",submission_in_progress:!1}}constructor(e){super(e),this.state=this.get_defaultstate(),this.handlechange_mjd_min=this.handlechange_mjd_min.bind(this),this.update_mjd_min=this.update_mjd_min.bind(this),this.handlechange_mjd_max=this.handlechange_mjd_max.bind(this),this.update_mjd_max=this.update_mjd_max.bind(this),this.submit=this.submit.bind(this)}componentDidMount(){this.update_mjd_min(this.state.mjd_min),this.update_mjd_max(this.state.mjd_max)}update_mjd_min(e){var t="";if(""==e)t="(leave blank to fetch earliest)";else try{var a=parseFloat(e),s=dateFromMJD(a).toISOString();t=s.includes(".")?s.split(".")[0]+"Z":s}catch(e){t="error",console.log("error",e,e.message)}this.setState({mjd_min:e,mjd_min_isoformat:t})}handlechange_mjd_min(e){this.update_mjd_min(e.target.value),localStorage.setItem("mjd_min",e.target.value)}update_mjd_max(e){var t="";if(""==e)t="(leave blank to fetch latest)";else try{var a=parseFloat(e);console.log("invalid?",e,a);var s=dateFromMJD(a).toISOString();t=s.includes(".")?s.split(".")[0]+"Z":s}catch(e){t="error",console.log("error",e,e.message)}this.setState({mjd_max:e,mjd_max_isoformat:t}),localStorage.setItem("mjd_max",e)}handlechange_mjd_max(e){this.update_mjd_max(e.target.value)}async submit(){var e={radeclist:this.state.radeclist,mjd_min:""==this.state.mjd_min?null:this.state.mjd_min,mjd_max:""==this.state.mjd_max?null:this.state.mjd_max,use_reduced:this.state.use_reduced,send_email:this.state.send_email,comment:this.state.comment};this.state.enable_propermotion&&(e.radec_epoch_year=this.state.radec_epoch_year,e.propermotion_ra=this.state.propermotion_ra,e.propermotion_dec=this.state.propermotion_dec),console.log(e),fetch(api_url_base,{credentials:"same-origin",method:"POST",body:JSON.stringify(e),headers:{"X-CSRFToken":getCookie("csrftoken"),Accept:"application/json","Content-Type":"application/json"}}).catch((e=>{submission_in_progress=!1,console.log("New task HTTP request failed",e),this.setState({httperror:"HTTP request failed.",submission_in_progress:!1})})).then((e=>{submission_in_progress=!1,this.setState({httperror:"",submission_in_progress:!1}),console.log("New task: HTTP response ",e.status),201==e.status?(console.log("New task: successful creation",e.status),localStorage.removeItem("radeclist"),localStorage.removeItem("enable_propermotion"),localStorage.removeItem("radec_epoch_year"),localStorage.removeItem("propermotion_ra"),localStorage.removeItem("propermotion_dec"),localStorage.removeItem("mjd_min"),localStorage.removeItem("mjd_max"),localStorage.removeItem("comment"),this.setState(this.get_defaultstate()),e.json().then((e=>{e.forEach(((e,t)=>{console.log("Created new task",e.id),newtaskids.push(e.id)}))})),window.history.pushState({},document.title,api_url_base),this.props.fetchData(!0)):400==e.status?e.json().then((e=>{console.log("New task: errors returned",e),this.setState({errors:e})})):console.log("New task: Error on submission: ",e.status)})).catch((e=>{submission_in_progress=!1,console.log("New task HTTP request failed",e),this.setState({httperror:"HTTP request failed. Check internet connection and server are online.",submission_in_progress:!1})}))}onSubmit(){event.preventDefault(),submission_in_progress?console.log("New task: Submission already in progress"):(console.log("New task: Submitting",api_url_base),submission_in_progress=!0,this.setState({submission_in_progress:!1}),this.submit())}render(){var e=[];e.push(React.createElement("ul",{key:"ulradec"},React.createElement("li",null,React.createElement("label",{htmlFor:"id_radeclist"},"RA Dec / MPC names:"),React.createElement("textarea",{name:"radeclist",cols:"",rows:"3",required:!0,id:"id_radeclist",value:this.state.radeclist,onChange:e=>{this.setState({radeclist:e.target.value}),localStorage.setItem("radeclist",e.target.value)}})," ",React.createElement("a",{onClick:()=>{this.setState({showradechelp:!this.state.showradechelp})}},"Help"),this.state.showradechelp?React.createElement("div",{id:"radec_help",style:{display:"block",clear:"right",fontSize:"small"},className:"collapse"},"Each line should consist of a right ascension and a declination coordinate (J2000) in decimal or sexagesimal notation (RA/DEC separated by a space or a comma) or 'mpc ' and a Minor Planet Center object name (e.g. 'mpc Makemake'). Limit of 100 objects per submission. If requested, email notification will be sent only after all targets in the list have been processed."):null),"radeclist"in this.state.errors?React.createElement("ul",{className:"errorlist"},React.createElement("li",null,this.state.errors.radeclist)):"")),e.push(React.createElement("div",{key:"propermotion_checkbox",id:"propermotion_checkboxdiv",style:{width:"100%"}},React.createElement("label",{style:{width:"100%"}},React.createElement("input",{type:"checkbox",checked:this.state.enable_propermotion,onChange:e=>{this.setState({enable_propermotion:e.target.checked}),localStorage.setItem("enable_propermotion",e.target.checked)},style:{position:"static",display:"inline",width:"5em"}})," Proper motion"))),this.state.enable_propermotion&&e.push(React.createElement("div",{key:"propermotion_panel",id:"propermotion_panel",style:{background:"rgb(235,235,235)"}},React.createElement("p",{key:"propermotiondesc",style:{fontSize:"small"}},"If the star is moving, the J2000 coordinates above are correct for a specified epoch along with proper motions in RA (angle) and Dec in milliarcseconds. The epoch of ATLAS observations varies from 2015.5 to the present. Note: these are angular velocities, not rates of coordinate change."),React.createElement("ul",{key:"propermotion_inputs"},React.createElement("li",{key:"radec_epoch_year"},React.createElement("label",{htmlFor:"id_radec_epoch_year"},"Epoch year:"),React.createElement("input",{type:"number",name:"radec_epoch_year",step:"0.1",id:"id_radec_epoch_year",value:this.state.radec_epoch_year,onChange:e=>{this.setState({radec_epoch_year:e.target.value}),localStorage.setItem("radec_epoch_year",e.target.value)}})),React.createElement("li",{key:"propermotion_ra"},React.createElement("label",{htmlFor:"id_propermotion_ra"},"PM RA [mas/yr]"),React.createElement("input",{type:"number",name:"propermotion_ra",step:"any",id:"id_propermotion_ra",value:this.state.propermotion_ra,onChange:e=>{this.setState({propermotion_ra:e.target.value}),localStorage.setItem("propermotion_ra",e.target.value)}})),React.createElement("li",{key:"propermotion_dec"},React.createElement("label",{htmlFor:"id_propermotion_dec"},"PM Dec [mas/yr]"),React.createElement("input",{type:"number",name:"propermotion_dec",step:"any",id:"id_propermotion_dec",value:this.state.propermotion_dec,onChange:e=>{this.setState({propermotion_dec:e.target.value}),localStorage.setItem("propermotion_dec",e.target.value)}}))))),e.push(React.createElement("ul",{key:"ulmjdoptions"},React.createElement("li",{key:"mjd_min"},React.createElement("label",{htmlFor:"id_mjd_min"},"MJD min:"),React.createElement("input",{type:"number",name:"mjd_min",step:"any",id:"id_mjd_min",value:this.state.mjd_min,onChange:this.handlechange_mjd_min}),React.createElement("a",{className:"btn",onClick:()=>{this.setState({mjd_min:getDefaultMjdMin()}),this.update_mjd_min(getDefaultMjdMin()),localStorage.removeItem("mjd_min")}},"↩️"),React.createElement("p",{className:"inputisodate",id:"id_mjd_min_isoformat"},this.state.mjd_min_isoformat)),React.createElement("li",{key:"mjd_max"},React.createElement("label",{htmlFor:"id_mjd_max"},"MJD max:"),React.createElement("input",{type:"number",name:"mjd_max",step:"any",id:"id_mjd_max",value:this.state.mjd_max,onChange:this.handlechange_mjd_max}),React.createElement("p",{className:"inputisodate",id:"id_mjd_max_isoformat"},this.state.mjd_max_isoformat),"mjd_max"in this.state.errors?React.createElement("ul",{className:"errorlist"},React.createElement("li",null,this.state.errors.mjd_max)):""),React.createElement("li",{key:"comment"},React.createElement("label",{htmlFor:"id_comment"},"Comment:"),React.createElement("input",{type:"text",name:"comment",maxLength:"300",id:"id_comment",value:this.state.comment,onChange:e=>{this.setState({comment:e.target.value}),localStorage.setItem("comment",e.target.value)}})),React.createElement("li",{key:"use_reduced"},React.createElement("input",{type:"checkbox",name:"use_reduced",id:"id_use_reduced",checked:this.state.use_reduced,onChange:e=>{this.setState({use_reduced:e.target.checked}),localStorage.setItem("use_reduced",e.target.checked)}}),React.createElement("label",{htmlFor:"id_use_reduced"},"Use reduced (input) instead of difference images (",React.createElement("a",{href:"../faq/"},"FAQ"),")")),React.createElement("li",{key:"send_email"},React.createElement("input",{type:"checkbox",name:"send_email",id:"id_send_email",checked:this.state.send_email,onChange:e=>{this.setState({send_email:e.target.checked}),localStorage.setItem("send_email",e.target.checked)}}),React.createElement("label",{htmlFor:"id_send_email"},"Email me when completed"))));var t=submission_in_progress?"btn btn-info submitting":"btn btn-info",a=submission_in_progress?"Requesting...":"Request";return e.push(React.createElement("input",{key:"submitbutton",className:t,id:"submitrequest",type:"submit",value:a})),""!=this.state.httperror&&e.push(React.createElement("p",{key:"httperror",style:{color:"red"}},this.state.httperror)),React.createElement("div",{key:"newrequestcontainer",id:"newrequestcontainer"},React.createElement("div",{key:"newrequestsource",className:"newrequest",id:"newrequestsource"},React.createElement("div",{key:"newtask",className:"task"},React.createElement("h2",{key:"newtaskheader"},"New request"),React.createElement("form",{key:"newtaskform",id:"newrequest",onSubmit:this.onSubmit.bind(this)},e))))}}class TaskPlot extends React.PureComponent{constructor(e){super(e)}componentDidMount(){console.log("activating plot",this.props.taskid);var e=new URL(this.props.taskurl);e.pathname+="resultplotdata.js",e.search="",$.ajax({url:e,cache:!0,dataType:"script"})}componentWillUnmount(){console.log("Unmounting plot for task ",this.props.taskid),delete jslimitsglobal["#plotforcedflux-task-"+this.props.taskid],delete jslcdataglobal["#plotforcedflux-task-"+this.props.taskid],delete jslabelsglobal["#plotforcedflux-task-"+this.props.taskid]}render(){return React.createElement("div",{key:"plot",id:"plotforcedflux-task-"+this.props.taskid,className:"plot",style:{width:"100%",height:"300px"}})}}class Task extends React.Component{constructor(e){super(e),this.state={},this.state.updateTimeElapsed=this.updateTimeElapsed.bind(this),this.state.interval=null,this.state.timeelapsed=-1}deleteTask(){var e="#task-"+this.props.taskdata.id;$(e).slideUp(200),setTimeout((()=>{$.ajax({url:this.props.taskdata.url,method:"delete",success:e=>{console.log("Deleted task ",this.props.taskdata.id),this.props.fetchData()},error:e=>{console.log("Failed to delete task ",this.props.taskdata.id,e),$("#task-"+this.props.taskdata.id).slideDown(100),this.props.fetchData()}})}),200)}requestImages(){var e=new URL(this.props.taskdata.url);e.pathname+="requestimages",e.search="",fetch(e,{credentials:"same-origin",method:"GET",headers:{"X-CSRFToken":getCookie("csrftoken"),Accept:"application/json","Content-Type":"application/json"}}).then((e=>{if(e.redirected){var t=parseInt(new URL(e.url).searchParams.get("newids"));newtaskids.push(t),console.log("requestimages created task",t);var a=new URL(e.url);a.searchParams.delete("newids"),window.history.pushState({},document.title,a),this.props.fetchData(!0)}}))}static getDerivedStateFromProps(e,t){if(null!=e.taskdata.starttimestamp&&null==e.taskdata.finishtimestamp){if(null==t.interval){var a=new Date(e.taskdata.starttimestamp).getTime(),s=((new Date).getTime()-a)/1e3;return{interval:setInterval(t.updateTimeElapsed,1e3),timeelapsed:s.toFixed(0)}}}else if(null!=t.interval)return{interval:null};return null}componentDidMount(){if(this.updateTimeElapsed(),newtaskids.includes(this.props.taskdata.id)){var e="#task-"+this.props.taskdata.id;console.log("showing new task",this.props.taskdata.id),$(e).hide(),$(e).slideDown(200),newtaskids=newtaskids.filter((e=>e!==this.props.taskdata.id))}}componentWillUnmount(){clearInterval(this.state.interval)}updateTimeElapsed(){if(null!=this.props.taskdata.starttimestamp&&null==this.props.taskdata.finishtimestamp){var e=new Date(this.props.taskdata.starttimestamp).getTime(),t=((new Date).getTime()-e)/1e3;this.setState({timeelapsed:t.toFixed(0)})}else null!=this.state.interval&&(clearInterval(this.state.interval),this.setState({interval:null}))}shouldComponentUpdate(e,t){return null!=e.taskdata.starttimestamp&&null==e.taskdata.finishtimestamp||JSON.stringify(e)!=JSON.stringify(this.props)}render(){var e=this.props.taskdata,t="none",a="none";null!=e.finishtimestamp?(t="finished",a="Delete"):null!=e.starttimestamp?(t="queued started",a="Cancel"):(t="queued notstarted",a="Cancel"),console.log("Task "+e.id+" rendered");var s=null;e.user_id==user_id&&(s=React.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>this.deleteTask()},a));var r=[React.createElement("div",{key:"rightside",className:"rightside"},s,React.createElement("img",{src:e.previewimage_url,style:{display:"block",marginTop:"1em",marginLeft:"1em"}}))];if(r.push(React.createElement("div",{key:"tasknum"},React.createElement("a",{key:"tasklink",href:e.url,onClick:t=>{this.props.setSingleTaskView(t,e.id,e.url)}},"Task ",e.id))),e.parent_task_url?r.push(React.createElement("p",{key:"imgrequest"},"Image request for ",React.createElement("a",{key:"parent_task_link",href:e.parent_task_url,onClick:t=>{this.props.setSingleTaskView(t,e.parent_task_id,e.parent_task_url)}},"Task ",e.parent_task_id))):e.parent_task_id?r.push(React.createElement("p",{key:"imgrequest"},"Image request for Task ",e.parent_task_id," (deleted)")):"IMGZIP"==e.request_type&&r.push(React.createElement("p",{key:"imgrequest"},"Image request")),"IMGZIP"==e.request_type){var i=e.use_reduced?"reduced":"difference";r.push(React.createElement("p",{key:"imgrequestnote"},"Up to the first 500 ",i," images will be retrieved. The image request and download link may expire after one week."))}if(e.user_id!=user_id&&r.push(React.createElement("div",{key:"user"},"User: ",e.username)),null!=e.comment&&""!=e.comment&&r.push(React.createElement("div",{key:"comment"},"Comment: ",React.createElement("b",null,e.comment))),null!=e.mpc_name&&""!=e.mpc_name)r.push(React.createElement("div",{key:"target"},"MPC Object: ",e.mpc_name));else{var l="";null!=e.radec_epoch_year&&(l=React.createElement("span",null,"(epoch ",e.radec_epoch_year,") ")),r.push(React.createElement("div",{key:"target"},"RA Dec: ",l,e.ra," ",e.dec)),(e.propermotion_ra>0||e.propermotion_dec>0)&&r.push(React.createElement("div",{key:"propermotion"},"Proper motion [mas/yr]: ",e.propermotion_ra," ",e.propermotion_dec))}if(r.push(React.createElement("div",{key:"imgtype"},"Images: ",e.use_reduced?"Reduced":"Difference")),null!=e.mjd_min||null!=e.mjd_max){var n=null!=e.mjd_min?e.mjd_min:"0",o=null!=e.mjd_max?e.mjd_max:"∞";r.push(React.createElement("div",{key:"mjdrange"},"MJD request: [",n,", ",o,"]"))}return r.push(React.createElement("div",{key:"queuetime"},"Queued at ",new Date(e.timestamp).toLocaleString())),null!=e.finishtimestamp?(r.push(React.createElement("div",{key:"status"},"Finished at ",new Date(e.finishtimestamp).toLocaleString())),null!=e.error_msg?r.push(React.createElement("p",{key:"error_msg",style:{color:"black",fontWeight:"bold",marginTop:"1em"}},"Error: ",e.error_msg)):("FP"==e.request_type&&(r.push(React.createElement("a",{key:"datalink",className:"results btn btn-info getdata",href:e.result_url,target:"_blank"},"Data")),r.push(React.createElement("a",{key:"pdflink",className:"results btn btn-info getpdf",href:e.pdfplot_url,target:"_blank"},"PDF"))),"IMGZIP"==e.request_type?null!=e.result_imagezip_url?r.push(React.createElement("a",{key:"imgdownload",className:"results btn btn-info",href:e.result_imagezip_url},"Download images (ZIP)")):r.push(React.createElement("p",null,"The download link has expired. Delete this task and request again if necessary.")):null!=e.imagerequest_task_id?e.imagerequest_finished?r.push(React.createElement("a",{key:"imgrequest",className:"btn btn-primary",href:e.imagerequest_url,onClick:t=>{this.props.setSingleTaskView(t,e.imagerequest_task_id,e.imagerequest_url)}},"Images retrieved")):r.push(React.createElement("a",{key:"imgrequest",className:"btn btn-warning",href:e.imagerequest_url,onClick:t=>{this.props.setSingleTaskView(t,e.imagerequest_task_id,e.imagerequest_url)}},"Images requested")):user_id==e.user_id&&r.push(React.createElement("button",{key:"imgrequest",className:"btn btn-info",onClick:()=>this.requestImages(),title:"Download FITS and JPEG images for up to the first 500 observations."},"Request ",e.use_reduced?"reduced":"diff"," images")))):null!=e.starttimestamp?r.push(React.createElement("div",{key:"status",style:{color:"red",fontStyle:"italic",marginTop:"1em"}},"Running (started ",this.state.timeelapsed," seconds ago)")):r.push(React.createElement("div",{key:"status",style:{fontStyle:"italic",marginTop:"1em"}},"Waiting (",e.queuepos," tasks ahead of this one)")),null==e.finishtimestamp||null!=e.error_msg||"FP"!=e.request_type||this.props.hidePlot||r.push(React.createElement(TaskPlot,{key:"plot",taskid:e.id,taskurl:e.url})),React.createElement("li",{key:"task-"+e.id,className:"task "+t,id:"task-"+e.id},r)}}var jslcdataglobal=new Object,jslabelsglobal=new Object,jslimitsglobal=new Object,tasklist_api_request_active=!1,tasklist_fetchcache=[],tasklist_api_error="";class Pager extends React.PureComponent{constructor(e){super(e),this.state={},null!=this.props.previous&&(this.state.previous_cursor=new URL(this.props.previous).searchParams.get("cursor")),null!=this.props.next&&(this.state.next_cursor=new URL(this.props.next).searchParams.get("cursor"))}static getDerivedStateFromProps(e,t){var a={};return null!=e.previous&&(a.previous_cursor=new URL(e.previous).searchParams.get("cursor")),null!=e.next&&(a.next_cursor=new URL(e.next).searchParams.get("cursor")),a}render(){return console.log("Pager rendered"),null==this.props.taskcount?null:React.createElement("div",{id:"paginator",key:"paginator"},React.createElement("p",{key:"pagedescription"},"Showing tasks ",this.props.pagefirsttaskposition+1,"-",this.props.pagefirsttaskposition+this.props.pagetaskcount," of ",this.props.taskcount),React.createElement("ul",{key:"prevnext",className:"pager"},null!=this.props.previous?React.createElement("li",{key:"previous",className:"previous"},React.createElement("a",{onClick:()=>{this.props.updateCursor(this.state.previous_cursor)},style:{cursor:"pointer"}},"« Newer")):null,null!=this.props.next?React.createElement("li",{key:"next",className:"next"},React.createElement("a",{onClick:()=>{this.props.updateCursor(this.state.next_cursor)},style:{cursor:"pointer"}},"Older »")):null))}}class TaskPage extends React.Component{constructor(e){super(e),this.state={taskcount:null,results:null,scrollToTopAfterUpdate:!1,dataurl:window.location.href,fetchtimeelapsed:null},this.newRequest=React.createRef(),this.setSingleTaskView=this.setSingleTaskView.bind(this),this.updateCursor=this.updateCursor.bind(this),this.fetchData=this.fetchData.bind(this)}filterclass(e,t){var a=new URL(t).searchParams.get("started");return null==e?null==a&&null==this.singleTaskViewTaskId(this.state.dataurl)?"btn-primary":"btn-link":"started"==e?"true"==a?"btn-primary":"btn-link":void 0}setFilter(e){console.log("changed filter to",e);var t=new URL(api_url_base);if(t.search="",null!=e&&t.searchParams.set(e,!0),t!=window.location.href){window.history.pushState({},document.title,t);var a={scrollToTopAfterUpdate:!0,dataurl:t};"started"==e&&null!=this.state.results&&(a.results=this.state.results.filter((e=>null!=e.starttimestamp)),0==a.results.length&&(a.results=null)),this.setState(a,(()=>{this.fetchData(!0)}))}}singleTaskViewTaskId(e){var t=e.toString().replace(api_url_base.toString(),"").split("/").filter((e=>0!=e.length));return 1!=t.length||isNaN(t[0])?null:parseInt(t[0])}setSingleTaskView(e,t,a){if(!(e.ctrlKey||e.metaKey||e.shiftKey)){e.preventDefault();var s=api_url_base+t+"/";window.history.pushState({},document.title,s),console.log("Task list changed to single task view for ",s.toString());var r=this.state.results.filter((e=>e.id==t));0==r.length&&(r=null),this.setState({results:r,scrollToTopAfterUpdate:!0,next:null,previous:null,pagefirsttaskposition:null,taskcount:null},(()=>{this.fetchData(!0)}))}}updateCursor(e){if(e!=new URL(window.location.href).searchParams.get("cursor")){console.log("Task list cursor changed to ",e);var t=new URL(window.location.href);null!=e?t.searchParams.set("cursor",e):t.searchParams.delete("cursor"),t.searchParams.delete("format"),window.history.pushState({},document.title,t),this.setState({scrollToTopAfterUpdate:!0},(()=>{this.fetchData(!0)}))}}fetchData(e){if(!document[hidden]&&user_is_active){if(this.setState({dataurl:window.location.href}),e)window.location.href in tasklist_fetchcache?(console.log("using tasklist_fetchcache before GET response",window.location.href),this.setState(tasklist_fetchcache[window.location.href])):console.log("no tasklist_fetchcache for",window.location.href);if(!tasklist_api_request_active||e){tasklist_api_request_active=!0;var t=window.location.href;console.log("Fetching task list from",t),fetch(t,{credentials:"same-origin",method:"GET",headers:{"X-CSRFToken":getCookie("csrftoken"),Accept:"application/json","Content-Type":"application/json"},redirect:"manual"}).then((e=>{if(tasklist_api_error="",tasklist_api_request_active=!1,"opaqueredirect"===e.type)window.location.href=e.url,console.log("Fetch got a redirection to ",e.url);else if(200!=e.status&&console.log("Fetch recieved HTTP status ",e.status),404==e.status&&(window.history.pushState({},document.title,api_url_base),this.setState({scrollToTopAfterUpdate:!0},(()=>{this.fetchData(!0)}))),200==e.status)return e.json();return null})).catch((e=>{tasklist_api_request_active=!1,console.log("Get task list HTTP request failed",e),tasklist_api_error="Connection error"})).then((a=>{var s=null;if(null!=a&&a.hasOwnProperty("results")?0==a.results.length&&null!=new URL(window.location.href).searchParams.get("cursor")?this.updateCursor(null):s=a:null!=a&&a.hasOwnProperty("id")&&(s={results:[a],next:null,previous:null,pagefirsttaskposition:null,taskcount:null}),null!=s){if(s.tasklist_last_fetch_time=new Date,tasklist_fetchcache[window.location.href]=s,t!=window.location.href)return void console.log("Not applying results from",t,"location.href",window.location.href);console.log("Applying results from",t),e&&(s.scrollToTopAfterUpdate=!0),this.setState(s)}}))}else console.log("prevent overlapping GET requests")}}componentDidUpdate(){this.state.scrollToTopAfterUpdate&&this.setState({scrollToTopAfterUpdate:!1})}componentDidMount(){this.fetchinterval=setInterval((()=>this.fetchData(!1)),2e3),this.fetchData(!0)}componentWillUnmount(){clearInterval(this.fetchinterval)}render(){var e,t=null!=this.singleTaskViewTaskId(this.state.dataurl),a=[];if(t?a.push(React.createElement("div",{key:"header",className:"page-header"},React.createElement("h1",null,"Task ",this.singleTaskViewTaskId(this.state.dataurl)))):a.push(React.createElement("div",{key:"header",className:"page-header"},React.createElement("h1",null,"Task Queue"))),(!t||null!=this.state.results&&this.state.results.length>0&&this.state.results[0].user_id==user_id)&&a.push(React.createElement("ul",{key:"filters",id:"taskfilters"},React.createElement("li",{key:"all"},React.createElement("a",{onClick:()=>this.setFilter(null),className:"btn "+this.filterclass(null,this.state.dataurl)},"All tasks")),React.createElement("li",{key:"started"},React.createElement("a",{onClick:()=>this.setFilter("started"),className:"btn "+this.filterclass("started",this.state.dataurl)},"Running/Finished")))),null!=this.state.tasklist_last_fetch_time&&a.push(React.createElement("p",{key:"tasklistfetchstatus",id:"tasklistfetchstatus"},"Last updated: ",this.state.tasklist_last_fetch_time.toLocaleString()," ",React.createElement("span",{className:"errors"},tasklist_api_error))),t||a.push(React.createElement(NewRequest,{key:"newrequest",fetchData:this.fetchData})),null==this.state.results)e=React.createElement("p",{key:"message"},"Loading tasks...");else if(0==this.state.results.length)e=React.createElement("p",{key:"message"},"There are no tasks.");else{var s=null!=this.state.results?this.state.results.length:null;e=[React.createElement("ul",{key:"ultasklist",className:"tasks"},this.state.results.map((e=>React.createElement(Task,{key:e.id,taskdata:e,fetchData:this.fetchData,setSingleTaskView:this.setSingleTaskView,hidePlot:s>10})))),React.createElement(Pager,{key:"pager",previous:this.state.previous,next:this.state.next,pagefirsttaskposition:this.state.pagefirsttaskposition,pagetaskcount:s,taskcount:this.state.taskcount,updateCursor:this.updateCursor})]}return a.push(React.createElement("div",{key:"tasklist",id:"tasklist",className:t?"singletaskdetail":null},e)),this.state.scrollToTopAfterUpdate&&(window.scrollTo(0,0),window.dispatchEvent(new Event("resize"))),a}}const container=document.getElementById("taskpage"),root=ReactDOM.createRoot(container);root.render(React.createElement(TaskPage,null));
