{% load static %}{% load i18n %}
{% for task in tasks %}
    {% if task.finishtimestamp %}
        <li class="task finished" id="task-{{task.id}}">
        <a class="btn btn-sm btn-danger" href="{% url 'delete' task.id %}">Delete</a>
    {% elif task.starttimestamp %}
        <li class="task queued started" id="task-{{task.id}}">
    {% else %}
    <li class="task queued notstarted" id="task-{{task.id}}">
        <a class="btn btn-sm btn-danger" href="{% url 'delete' task.id %}">Cancel</a>
    {% endif %}
        <a href="{% url 'task-detail' task.id %}">Task {{task.id}}</a><br/>
        {% if task.user.id != request.user.id %}
        User: {{task.user.username}} ({{task.user.email}})<br/>
        {% endif %}
        {% if task.comment %}
        Comment: <b>{{task.comment}}</b><br/>
        {% endif %}
        RA Dec: {{task.ra}} {{task.dec}}<br/>
        Images: {%if task.use_reduced %}Reduced{% else %}Difference{% endif %}<br/>

        {% if task.mjd_min or task.mjd_max %}
            MJD range: [{{task.mjd_min|default:"0"}}, {{task.mjd_max|default:"âˆž"}}]<br/>
        {% endif %}

        Queued at {{task.timestamp|date:'Y-m-d H:i:s e'}}<br/>
        {% if task.finishtimestamp %}
        Finished{% if task.finishtimestamp %} at {{task.finishtimestamp|date:'Y-m-d H:i:s e'}}{% endif %}<br/>
        <a class="results btn btn-info getdata" href="{% static task.localresultfile %}" target="_blank">Get Data</a>
        <a class="results btn btn-info showplot" onclick="javascript:$.ajax({url: '{% url 'resultdatajs' task.id %}', cache: true, dataType: 'script'}); this.style='display: none;'">Show Plot</a>
        <div id="plotforcedflux-task-{{task.id}}" class="plot" style="width: 100%;"></div>

        {% elif task.starttimestamp %}
        <span style="color: red;">Started running...</span>
        {% else %}
        Queued ({{task.queuepos}} tasks ahead of this one)
        {% endif %}
    </li>
{% endfor %}
